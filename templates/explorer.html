<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Archetype Explorer — Archetype Retreats</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Explorer-only CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/explorer.css') }}">
</head>

<body>

<main class="wrap">

  <!-- INTRO -->
  <header class="intro">
    <h1>Archetype Explorer</h1>
    <p class="sub">
      A brief mirror to notice how you move through the world.<br>
      No sign-up. No scores. Just recognition.
    </p>
    <p class="hint">
      Choose what feels most natural — not what sounds best.
    </p>
  </header>

  <!-- PROGRESS -->
  <div class="progress" id="progress">0 / 10 answered</div>

  <!-- QUESTIONS -->
  <section id="quiz"></section>

  <!-- ACTIONS -->
  <div class="actions">
    <button class="btn primary" id="btnResult" type="button">See Result</button>
    <button class="btn ghost" id="btnReset" type="button">Reset</button>
  </div>

  <!-- OUTPUT (errors / messages) -->
  <div id="out"></div>

  <!-- RESULTS -->
  <section id="results" class="results hidden">
    <div class="result-header">
      <div class="badge">
        <span class="dot"></span>
        <span>Your archetype</span>
      </div>
      <h2 class="result-title" id="resultTitle"></h2>
    </div>

    <div class="result-body" id="resultBody"></div>

    <ul class="result-lines" id="resultLines"></ul>

    <div class="result-cta">
      <p class="small">
        This is a mirror, not a label.<br>
        If it resonates, keep it. If it doesn’t, let it go.
      </p>

      <div class="actions">
        <button class="btn ghost" id="btnResetBottom" type="button">Reset</button>
        <a class="btn primary" href="/shop">Explore Further</a>
      </div>
    </div>
  </section>

</main>

<script>
/* ===============================
   DATA
================================ */

const ARCH = {
  dreamer: {
    name: "The Dreamer",
    description: "You sense what wants to emerge before it has form.",
    lines: [
      "You feel potential before structure appears",
      "You trust intuition over certainty",
      "You move by resonance, not pressure"
    ]
  },
  visionary: {
    name: "The Visionary",
    description: "You look ahead and orient toward what is becoming.",
    lines: [
      "You track direction and momentum",
      "You think in arcs, not moments",
      "You are drawn to long-range meaning"
    ]
  },
  observer: {
    name: "The Observer",
    description: "You watch carefully before stepping in.",
    lines: [
      "You notice patterns others miss",
      "You value understanding over speed",
      "You prefer clarity before action"
    ]
  },
  alchemist: {
    name: "The Alchemist",
    description: "You adapt in real time, shaping things as they move.",
    lines: [
      "You learn by doing",
      "You adjust as conditions change",
      "You trust movement more than planning"
    ]
  }
};

const QUESTIONS = [
  {
    q: "When you enter a new situation, what happens first?",
    a: [
      ["dreamer", "I sense what could emerge"],
      ["visionary", "I look for where this is going"],
      ["observer", "I watch to understand the dynamic"],
      ["alchemist", "I step in and adjust as I go"]
    ]
  },
  {
    q: "When something feels unclear, you tend to:",
    a: [
      ["dreamer", "Sit with it until it takes shape"],
      ["visionary", "Ask what it’s pointing toward"],
      ["observer", "Gather more perspective"],
      ["alchemist", "Act and see what changes"]
    ]
  }
  // (Add remaining questions here — structure stays the same)
];

/* ===============================
   STATE
================================ */

const quiz = document.getElementById("quiz");
const out = document.getElementById("out");
const progress = document.getElementById("progress");

const results = document.getElementById("results");
const title = document.getElementById("resultTitle");
const body = document.getElementById("resultBody");
const lines = document.getElementById("resultLines");

/* ===============================
   RENDER QUESTIONS
================================ */

function renderQuiz() {
  quiz.innerHTML = "";
  QUESTIONS.forEach((item, i) => {
    const block = document.createElement("div");
    block.className = "q";

    const h = document.createElement("h3");
    h.textContent = `${i + 1}. ${item.q}`;
    block.appendChild(h);

    item.a.forEach(([key, text]) => {
      const label = document.createElement("label");
      label.className = "opt";

      const input = document.createElement("input");
      input.type = "radio";
      input.name = `q${i}`;
      input.value = key;
      input.addEventListener("change", updateProgress);

      label.appendChild(input);
      label.appendChild(document.createTextNode(text));
      block.appendChild(label);
    });

    quiz.appendChild(block);
  });
}

/* ===============================
   LOGIC
================================ */

function getAnswers() {
  const answers = {};
  QUESTIONS.forEach((_, i) => {
    const checked = document.querySelector(`input[name="q${i}"]:checked`);
    answers[i] = checked ? checked.value : null;
  });
  return answers;
}

function tally(ans) {
  const counts = {};
  const order = [];

  Object.values(ans).forEach(v => {
    if (!v) return;
    counts[v] = (counts[v] || 0) + 1;
    if (!order.includes(v)) order.push(v);
  });

  return { counts, order };
}

function pickArchetype(counts, order) {
  const max = Math.max(...Object.values(counts));
  const tied = Object.keys(counts).filter(k => counts[k] === max);
  return order.find(o => tied.includes(o));
}

function updateProgress() {
  const done = Object.values(getAnswers()).filter(Boolean).length;
  progress.textContent = `${done} / ${QUESTIONS.length} answered`;
}

/* ===============================
   RESULTS
================================ */

function showResult(key) {
  const data = ARCH[key];
  title.textContent = data.name;
  body.innerHTML = `<p class="lead">${data.description}</p>`;
  lines.innerHTML = "";

  data.lines.forEach(line => {
    const li = document.createElement("li");
    li.textContent = line;
    lines.appendChild(li);
  });

  results.classList.remove("hidden");
  results.scrollIntoView({ behavior: "smooth", block: "start" });
}

/* ===============================
   EVENTS
================================ */

document.getElementById("btnResult").addEventListener("click", () => {
  const answers = getAnswers();
  if (Object.values(answers).some(v => v === null)) {
    out.innerHTML = `<div class="err">Please answer all questions.</div>`;
    return;
  }
  const { counts, order } = tally(answers);
  showResult(pickArchetype(counts, order));
});

document.getElementById("btnReset").addEventListener("click", resetAll);
document.getElementById("btnResetBottom").addEventListener("click", resetAll);

function resetAll() {
  document.querySelectorAll("input[type=radio]").forEach(i => i.checked = false);
  out.innerHTML = "";
  results.classList.add("hidden");
  updateProgress();
  window.scrollTo({ top: 0, behavior: "smooth" });
}

/* ===============================
   INIT
================================ */

renderQuiz();
updateProgress();
</script>

</body>
</html>
