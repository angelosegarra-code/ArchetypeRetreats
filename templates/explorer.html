<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Archetype Explorer — Archetype Retreats</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/explorer.css') }}">
</head>

<body>
  <main class="wrap">
    <header class="hero">
      <h1>Archetype Explorer</h1>
      <p class="sub">
        A brief mirror to notice how you move through the world. No sign-up.
        <br><span class="muted">No scores. Just recognition.</span>
      </p>
      <p class="hint">Choose what feels most natural — not what sounds best.</p>
    </header>

    <section id="quiz" class="quiz"></section>

    <div class="bar">
      <div class="progress" id="progressText">0/10 answered</div>
      <div class="actions">
        <button class="btn ghost" id="btnReset" type="button">Reset</button>
        <button class="btn primary" id="btnResult" type="button">See Result</button>
      </div>
    </div>

    <section id="results" class="results hidden">
      <div class="result-header">
        <div class="badge">
          <span class="dot"></span>
          <span id="resultBadge">Your archetype</span>
        </div>
        <h2 class="result-title" id="resultTitle">—</h2>
      </div>

      <div class="result-body" id="resultBody">—</div>
      <ul class="result-lines" id="resultLines"></ul>

      <div class="result-cta">
        <div class="small">
          This is a mirror, not a label. If it resonates, keep it. If it doesn’t, let it go.
        </div>
        <div class="actions">
          <button class="btn ghost" id="resetBtn2" type="button">Reset</button>
          <a class="btn primary" href="/shop">Explore the Reset</a>
        </div>
      </div>
    </section>

    <footer class="foot">
      <a href="/" class="back">← Back to Archetype Retreats</a>
    </footer>
  </main>

  <script>
    // --- Archetypes (simple order) ---
    const ARCH = {
      dreamer: {
        name: "Dreamer",
        description: "You start with possibility. You sense what could emerge before it has words.",
        lines: ["You lead with imagination.", "You notice subtle openings.", "You trust the first spark."]
      },
      visionary: {
        name: "Visionary",
        description: "You orient toward direction. You look for where things are going and why it matters.",
        lines: ["You think in trajectories.", "You prefer a clear horizon.", "You move with intention."]
      },
      observer: {
        name: "Observer",
        description: "You begin by seeing. You read the dynamic first, then decide what’s true.",
        lines: ["You notice patterns quickly.", "You stay steady under noise.", "You learn before you act."]
      },
      alchemist: {
        name: "Alchemist",
        description: "You adapt in motion. You step in, test, adjust, and transform what’s happening.",
        lines: ["You change systems from within.", "You iterate instead of waiting.", "You turn friction into fuel."]
      }
    };

    // --- Questions (10) ---
    const QUESTIONS = [
      {
        q: "When you enter a new situation, what happens first?",
        a: [
          { t: "I sense what could emerge", k: "dreamer" },
          { t: "I look for where this is going", k: "visionary" },
          { t: "I watch to understand the dynamic", k: "observer" },
          { t: "I step in and adjust as I go", k: "alchemist" }
        ]
      },
      {
        q: "When something feels unclear, you tend to:",
        a: [
          { t: "Sit with it until it takes shape", k: "dreamer" },
          { t: "Find the thread that leads forward", k: "visionary" },
          { t: "Collect details until it resolves", k: "observer" },
          { t: "Try something and refine in real time", k: "alchemist" }
        ]
      },
      {
        q: "Your strength under stress is usually:",
        a: [
          { t: "Staying open to a new possibility", k: "dreamer" },
          { t: "Remembering the long-term meaning", k: "visionary" },
          { t: "Staying calm and reading what’s real", k: "observer" },
          { t: "Taking action and shifting momentum", k: "alchemist" }
        ]
      },
      {
        q: "People often come to you for:",
        a: [
          { t: "Fresh ideas and perspective", k: "dreamer" },
          { t: "Direction and clarity", k: "visionary" },
          { t: "Insight and honest reflection", k: "observer" },
          { t: "Solutions and transformation", k: "alchemist" }
        ]
      },
      {
        q: "When you’re creating something, you prefer to:",
        a: [
          { t: "Explore and let it reveal itself", k: "dreamer" },
          { t: "Design the arc before you begin", k: "visionary" },
          { t: "Study, research, and refine", k: "observer" },
          { t: "Prototype fast and iterate", k: "alchemist" }
        ]
      },
      {
        q: "Your natural leadership style is:",
        a: [
          { t: "Inspiring imagination", k: "dreamer" },
          { t: "Setting a compelling direction", k: "visionary" },
          { t: "Seeing what others miss", k: "observer" },
          { t: "Making change practical", k: "alchemist" }
        ]
      },
      {
        q: "When faced with a big decision, you usually:",
        a: [
          { t: "Notice the option that feels alive", k: "dreamer" },
          { t: "Choose the path with the best future", k: "visionary" },
          { t: "Wait until you see the full picture", k: "observer" },
          { t: "Move, learn, adjust, and commit", k: "alchemist" }
        ]
      },
      {
        q: "What drains you fastest?",
        a: [
          { t: "Being forced into rigid certainty", k: "dreamer" },
          { t: "Wandering without direction", k: "visionary" },
          { t: "Noise, chaos, and emotional pressure", k: "observer" },
          { t: "Endless talking with no movement", k: "alchemist" }
        ]
      },
      {
        q: "Your blind spot can look like:",
        a: [
          { t: "Floating too long in possibility", k: "dreamer" },
          { t: "Pushing a vision too early", k: "visionary" },
          { t: "Watching instead of entering", k: "observer" },
          { t: "Changing things before understanding them", k: "alchemist" }
        ]
      },
      {
        q: "At your best, you feel like:",
        a: [
          { t: "A doorway opening", k: "dreamer" },
          { t: "A compass pointing true", k: "visionary" },
          { t: "A clear mirror", k: "observer" },
          { t: "A catalyst", k: "alchemist" }
        ]
      }
    ];

    // --- Render ---
    const quizEl = document.getElementById("quiz");
    const progressEl = document.getElementById("progressText");
    const resultsEl = document.getElementById("results");
    const outTitle = document.getElementById("resultTitle");
    const outBody = document.getElementById("resultBody");
    const outLines = document.getElementById("resultLines");

    function renderQuiz() {
      quizEl.innerHTML = "";
      QUESTIONS.forEach((item, idx) => {
        const card = document.createElement("div");
        card.className = "card";

        const h = document.createElement("h3");
        h.innerHTML = `<span class="n">${idx + 1}.</span> ${item.q}`;
        card.appendChild(h);

        const opts = document.createElement("div");
        opts.className = "options";

        item.a.forEach((opt, j) => {
          const id = `q${idx}_${j}`;
          const label = document.createElement("label");
          label.className = "opt";
          label.innerHTML = `
            <input type="radio" name="q${idx}" value="${opt.k}" id="${id}">
            <span>${opt.t}</span>
          `;
          opts.appendChild(label);
        });

        card.appendChild(opts);
        quizEl.appendChild(card);
      });

      document.querySelectorAll('input[type="radio"]').forEach(i => {
        i.addEventListener("change", updateProgress);
      });

      updateProgress();
    }

    function updateProgress() {
      let done = 0;
      for (let i = 0; i < QUESTIONS.length; i++) {
        const picked = document.querySelector(`input[name="q${i}"]:checked`);
        if (picked) done++;
      }
      progressEl.textContent = `${done}/${QUESTIONS.length} answered`;
    }

    function getAnswers() {
      const picks = [];
      for (let i = 0; i < QUESTIONS.length; i++) {
        const picked = document.querySelector(`input[name="q${i}"]:checked`);
        picks.push(picked ? picked.value : null);
      }
      return picks;
    }

    function pickArchetype(answers) {
      const counts = { dreamer: 0, visionary: 0, observer: 0, alchemist: 0 };
      const order = [];
      answers.forEach(v => {
        if (!v) return;
        counts[v]++;
        order.push(v);
      });

      const max = Math.max(...Object.values(counts));
      const tied = Object.keys(counts).filter(k => counts[k] === max);

      // tie-break: earliest chosen in their answer order
      for (const v of order) {
        if (tied.includes(v)) return v;
      }
      return tied[0] || "observer";
    }

    function showResult(key) {
      const data = ARCH[key];
      outTitle.textContent = data.name;
      outBody.textContent = data.description;

      outLines.innerHTML = "";
      data.lines.forEach(line => {
        const li = document.createElement("li");
        li.textContent = line;
        outLines.appendChild(li);
      });

      resultsEl.classList.remove("hidden");
      resultsEl.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function resetAll() {
      document.querySelectorAll('input[type="radio"]').forEach(i => i.checked = false);
      resultsEl.classList.add("hidden");
      updateProgress();
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    document.getElementById("btnResult").addEventListener("click", () => {
      const answers = getAnswers();
      if (answers.some(v => v === null)) {
        alert("Please answer all 10 questions.");
        return;
      }
      showResult(pickArchetype(answers));
    });

    document.getElementById("btnReset").addEventListener("click", resetAll);
    document.getElementById("resetBtn2").addEventListener("click", resetAll);

    renderQuiz();
  </script>
</body>
</html>
