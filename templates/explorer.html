<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Archetype Explorer — Archetype Retreats</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Independent CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/explorer.css') }}">
</head>

<body>
  <div class="wrap">

    <section class="intro">
      <h1>Archetype Explorer</h1>
      <div class="sub">
        A brief mirror to notice how you move through the world. No sign-up.
        <br> No scores. Just recognition.
      </div>
      <div class="hint">Choose what feels most natural — not what sounds best.</div>
      <div class="progress" id="progress">0/10 answered</div>
    </section>

    <!-- Quiz renders here -->
    <div id="quiz"></div>

    <!-- Buttons -->
    <div class="actions">
      <button class="btn ghost" id="btnReset" type="button">Reset</button>
      <button class="btn primary" id="btnResult" type="button">See Result</button>
    </div>

    <!-- Inline errors -->
    <div id="out"></div>

    <!-- Results section (your new layout) -->
    <section id="results" class="results hidden">
      <div class="result-header">
        <div class="badge">
          <span class="dot"></span>
          <span id="resultBadge">Your archetype</span>
        </div>
        <h2 class="result-title" id="resultTitle">—</h2>
      </div>

      <div class="result-body" id="resultBody">—</div>

      <ul class="result-lines" id="resultLines"></ul>

      <div class="result-cta">
        <div class="small">
          This is a mirror, not a label. If it resonates, keep it. If it doesn’t, let it go.
        </div>
        <div class="actions">
          <button class="btn ghost" id="resetBtn" type="button">Reset</button>
          <a class="btn primary" href="/shop">Explore the Reset</a>
        </div>
      </div>
    </section>

  </div>

  <script>
    // -------------------------
    // 10 Questions (Dreamer, Visionary, Observer, Alchemist)
    // -------------------------
    const ARCH = {
      dreamer: {
        name: "Dreamer",
        description: "You begin in possibility. You sense what could be, before it has words.",
        lines: [
          "You trust the subtle signal.",
          "You move by intuition, not proof.",
          "When you rush, you lose the thread."
        ]
      },
      visionary: {
        name: "Visionary",
        description: "You orient toward direction. You look for trajectory and meaning.",
        lines: [
          "You see the arc, not the moment.",
          "You want alignment more than comfort.",
          "Your clarity sharpens when you simplify."
        ]
      },
      observer: {
        name: "Observer",
        description: "You watch first. You study the dynamic before you step in.",
        lines: [
          "You notice patterns others miss.",
          "You prefer precision over speed.",
          "Your power is in accurate seeing."
        ]
      },
      alchemist: {
        name: "Alchemist",
        description: "You adjust as you go. You transform situations from inside the moment.",
        lines: [
          "You learn by doing.",
          "You can pivot without panic.",
          "You turn friction into movement."
        ]
      }
    };

    const QUESTIONS = [
      {
        text: "When you enter a new situation, what happens first?",
        options: [
          { key: "dreamer",   label: "I sense what could emerge" },
          { key: "visionary", label: "I look for where this is going" },
          { key: "observer",  label: "I watch to understand the dynamic" },
          { key: "alchemist", label: "I step in and adjust as I go" }
        ]
      },
      {
        text: "When something feels unclear, you tend to:",
        options: [
          { key: "dreamer",   label: "Sit with it until it takes shape" },
          { key: "visionary", label: "Ask what the larger purpose is" },
          { key: "observer",  label: "Gather details until the pattern shows" },
          { key: "alchemist", label: "Try something small and see what changes" }
        ]
      },
      {
        text: "In relationships, you’re most sensitive to:",
        options: [
          { key: "dreamer",   label: "Unspoken feelings and atmospheres" },
          { key: "visionary", label: "Shared direction and future" },
          { key: "observer",  label: "Consistency and honest signals" },
          { key: "alchemist", label: "What can be improved right now" }
        ]
      },
      {
        text: "When you’re under pressure, you naturally:",
        options: [
          { key: "dreamer",   label: "Withdraw to reconnect to the inner signal" },
          { key: "visionary", label: "Refocus on the objective and path" },
          { key: "observer",  label: "Pause and analyze what’s really happening" },
          { key: "alchemist", label: "Act quickly and course-correct" }
        ]
      },
      {
        text: "Your best decisions usually come from:",
        options: [
          { key: "dreamer",   label: "A quiet ‘yes’ you can’t explain" },
          { key: "visionary", label: "Seeing the long-term outcome" },
          { key: "observer",  label: "Evidence, patterns, and timing" },
          { key: "alchemist", label: "Iteration — trying, learning, refining" }
        ]
      },
      {
        text: "When you create something, you prefer to:",
        options: [
          { key: "dreamer",   label: "Let it arrive organically" },
          { key: "visionary", label: "Work from a concept or theme" },
          { key: "observer",  label: "Study references and structure" },
          { key: "alchemist", label: "Play, test, and reshape constantly" }
        ]
      },
      {
        text: "If someone disagrees with you, you’re likely to:",
        options: [
          { key: "dreamer",   label: "Feel the emotional truth underneath" },
          { key: "visionary", label: "Reframe toward shared goals" },
          { key: "observer",  label: "Ask questions and clarify definitions" },
          { key: "alchemist", label: "Adapt your approach to move forward" }
        ]
      },
      {
        text: "You feel most ‘yourself’ when you are:",
        options: [
          { key: "dreamer",   label: "In solitude, sensing and imagining" },
          { key: "visionary", label: "Building toward a meaningful future" },
          { key: "observer",  label: "Studying, learning, noticing" },
          { key: "alchemist", label: "In motion, transforming, doing" }
        ]
      },
      {
        text: "What do you trust most?",
        options: [
          { key: "dreamer",   label: "Intuition" },
          { key: "visionary", label: "Direction" },
          { key: "observer",  label: "Accuracy" },
          { key: "alchemist", label: "Change" }
        ]
      },
      {
        text: "When life resets you, your first instinct is to:",
        options: [
          { key: "dreamer",   label: "Return to the inner voice" },
          { key: "visionary", label: "Redesign the path" },
          { key: "observer",  label: "Understand the pattern" },
          { key: "alchemist", label: "Rebuild through action" }
        ]
      }
    ];

    // -------------------------
    // Render
    // -------------------------
    const quizEl = document.getElementById("quiz");
    const progressEl = document.getElementById("progress");
    const outEl = document.getElementById("out");

    const resultsEl = document.getElementById("results");
    const resultTitleEl = document.getElementById("resultTitle");
    const resultBodyEl = document.getElementById("resultBody");
    const resultLinesEl = document.getElementById("resultLines");

    function renderQuiz(){
      quizEl.innerHTML = "";
      QUESTIONS.forEach((q, idx) => {
        const wrap = document.createElement("div");
        wrap.className = "q";

        const h = document.createElement("h3");
        h.textContent = `${idx + 1}. ${q.text}`;
        wrap.appendChild(h);

        q.options.forEach((opt) => {
          const label = document.createElement("label");
          label.className = "opt";

          const input = document.createElement("input");
          input.type = "radio";
          input.name = `q${idx}`;
          input.value = opt.key;
          input.addEventListener("change", updateProgress);

          label.appendChild(input);
          label.appendChild(document.createTextNode(opt.label));
          wrap.appendChild(label);
        });

        quizEl.appendChild(wrap);
      });

      updateProgress();
    }

    function getAnswers(){
      const answers = [];
      for(let i=0;i<QUESTIONS.length;i++){
        const checked = document.querySelector(`input[name="q${i}"]:checked`);
        answers.push(checked ? checked.value : null);
      }
      return answers;
    }

    function updateProgress(){
      const answers = getAnswers();
      const done = answers.filter(Boolean).length;
      progressEl.textContent = `${done}/${QUESTIONS.length} answered`;
    }

    function tally(answers){
      const counts = { dreamer:0, visionary:0, observer:0, alchemist:0 };
      const order = []; // for tie-break
      answers.forEach(a => {
        if(a){
          counts[a] += 1;
          order.push(a);
        }
      });
      return { counts, order };
    }

    function pickArchetype(counts, order){
      const entries = Object.entries(counts);
      entries.sort((a,b)=> b[1]-a[1]);
      const top = entries[0][1];
      const tied = entries.filter(e => e[1] === top).map(e => e[0]);
      if(tied.length === 1) return tied[0];
      // tie-break: whichever appears first in chosen order
      for(const v of order){
        if(tied.includes(v)) return v;
      }
      return tied[0];
    }

    function showResult(key){
      const data = ARCH[key];

      // hide inline out
      outEl.innerHTML = "";

      // fill results section
      resultTitleEl.textContent = data.name;
      resultBodyEl.innerHTML = `<p class="lead">${data.description}</p>`;

      resultLinesEl.innerHTML = "";
      data.lines.forEach(line => {
        const li = document.createElement("li");
        li.textContent = line;
        resultLinesEl.appendChild(li);
      });

      resultsEl.classList.remove("hidden");
      resultsEl.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    // Buttons
    document.getElementById("btnResult").addEventListener("click", () => {
      const answers = getAnswers();
      if(answers.some(v => v === null)){
        outEl.innerHTML = `<div class="err">Please answer all 10 questions.</div>`;
        return;
      }
      const { counts, order } = tally(answers);
      const primary = pickArchetype(counts, order);
      showResult(primary);
    });

    function resetAll(){
      document.querySelectorAll('input[type="radio"]').forEach(i => i.checked = false);
      outEl.innerHTML = "";
      resultsEl.classList.add("hidden");
      updateProgress();
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    document.getElementById("btnReset").addEventListener("click", resetAll);
    document.getElementById("resetBtn").addEventListener("click", resetAll);

    // GO
    renderQuiz();
  </script>
</body>
</html>
